{% load static %}
<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="stylesheet" type="text/css" href="{% static 'scss/dashboard-admin/style.css' %}">

	<!-- {% comment %} font awesome {% endcomment %} -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css" integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A==" crossorigin="anonymous" referrerpolicy="no-referrer" />


	<!-- Boxiocns CDN Link -->
    <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>

	<!-- CSS only -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">

	{% comment %} select {% endcomment %}
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.6/js/standalone/selectize.min.js" integrity="sha256-+C0A5Ilqmu4QcSPxrlGpaZxJ04VjsRjKu+G82kl5UJk=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.6/css/selectize.bootstrap3.min.css" integrity="sha256-ze/OEYGcFbPRmvCnrSeKbRTtjG4vGLHXgOqsyLFTRjg=" crossorigin="anonymous" /> 

	<!-- JavaScript Bundle with Popper -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
	<title>{% block title %}Admin Brigad Style{% endblock title %}</title>
</head>

<body>
	<div class="webpage">
		<div class="container">
			{% include "dashboard-admin/parts-tool/navbar.html" %}
			{% block content %}
			<main>
				<div class="dashboard">
					<div class="content">
						<div class="cards">
							<div class="card">
								<div class="content">
									<div class="pric">
										<h3>{{t_n_i_c}} DH</h3>
										<p>REVENU NET TOTAL</p>
									</div>
									<i class="fa-solid fa-dollar-sign"></i>
								</div>
							</div>
							<div class="card">
								<div class="content">
									<div class="pric">
										<h3>{{total_fee}} DH</h3>
										<p>TOTAL les frais</p>
									</div>
									<i class='bx bxs-wallet'></i>
								</div>
							</div>
							<div class="card">
								<div class="content">
									<div class="pric">
										<h3>{{total_packages}}</h3>
										<p>LES COLIES</p>
									</div>
									<i class="fa-solid fa-cube"></i>
								</div>
							</div>
							<div class="card">
								<div class="content">
									<div class="pric">
										<h3>{{t_p_d}}</h3>
										<p>colis livrés</p>
									</div>
									<i class="fa-solid fa-truck-ramp-box"></i>
								</div>
							</div>
						</div>
						<div class="block container text-center mt-5 ">
							<!-- custemers and admin-delivery -->
							<div class="row justify-content-between mb-5">
								<div class="users show-data custemers col-5">
									<div class="top">
										<h1>All users</h1>
										<small class="ms-2 " style="color: #efcefa;">{{users.count}}</small>
									</div>
									<div class="body">
										<div class="filter">
											<form action="" method="GET">
												<input type="search" name="search" id="search" placeholder="Search with username or company name">
											</form>
										</div>
										<div class="content">
											{% for user in users %}
											<div class="user">
												<div class="info">
													<div class="logo">
														{% if user.image %}
														<img src="{{user.image.url}}" alt="">
														{% else %}
														<img src="{% static 'img/profile/default_profile.png' %}" alt="">
														{% endif %}
													</div>
													<div class="username">
														<h4 class="name">{{user.user}}</h4>
														<p class="company-name">{{user.business_name}}</p>
													</div>
												</div>
												<div class="actions">
													<a href="{% url 'view_user' user.user.id %}"><i class='bx bx-show'></i></a>
												</div>
											</div>
											{% endfor %}
										</div>
									</div>
								</div>
								<div class="users show-data admin-men-delivery col-5">
									<div class="top">
										<h1>admins-men-delivery</h1>
										<small class="ms-2 " style="color: #efcefa;">{{admins_delivery.count}}</small>
									</div>
									<div class="body">
										<div class="filter">
											<form action="" method="GET">
												<input type="search" name="search" id="search" placeholder="Search with username or company name">
											</form>
										</div>
										<div class="content">
											{% for adminDelivery in admins_delivery %}
											<div class="user admin-delivery">
												<div class="info">
													<div class="logo">
														<img src="{% static 'img/profile/default_profile.png' %}" alt="">
													</div>
													<div class="username">
														<h4 class="name">{{adminDelivery.user}}</h4>
														<p class="company-name">{{adminDelivery.city}}</p>
													</div>
												</div>
												<div class="actions">
													<a href="{% url 'view_admin' adminDelivery.user.id %}"><i class='bx bx-show'></i></a>
												</div>
											</div>
											{% endfor %}
										</div>
									</div>
								</div>
							</div>
							<!-- end -->
							<!-- tracking-orders -->
							<div class="row justify-content-between mb-5">
								<div class="tracking show-data tracking-orders col-12">
									<div class="top">
										<h1>Tracking Order</h1>
										<small class="ms-2 " style="color: #efcefa;">{{ordersTracking.count}}</small>
									</div>
									<div class="body">
										<div class="filter">
											<form action="" method="GET">
												<input type="search" name="search" id="search" placeholder="Search with username or company name">
											</form>
										</div>
										<div class="content">
											<div class='tracking'>
												<table class="table table-bordered table-hover">
													<thead>
														<tr>
															<th scope="col">ID</th>
															<th scope="col">Date</th>
															<th scope="col">Warehouse</th>
															<th scope="col">City</th>
															<th scope="col">Livry</th>
															<th scope="col">Actions</th>
														</tr>
													</thead>
													<tbody >
														{% for tracking in ordersTracking %}
															<form action="" method="POST">
																{% csrf_token %}
																<tr>
																	<th scope="row" data="{{tracking.id_received}}" class="id id-refund" id="ind">{{tracking.id_received}}</th>
																	<td hidden>
																		<input name="user" type="text" value="{{tracking.user.id}}" hidden>
																		<input name="received" type="text" value="{{tracking.received.id}}" hidden>
																		<input name="id_received" type="text" value="{{tracking.id_received}}" hidden>
																		<input name="tracking_number" type="text" value="{{tracking.tracking_number}}" hidden>
																		<input name="date" type="text" value="{{tracking.date}}" hidden>
																		<input name="warehouse" type="text" value="{{tracking.warehouse}}" hidden>
																		<input name="city" type="text" value="{{tracking.city}}" hidden>
																		<input name="livry" type="text" value="{{tracking.livry}}" hidden>
																	</td>
																	<td>{{tracking.date}}</td>
																	<td>
																		<select name="warehouse" class="form-select" id="inlineFormSelectPref">
																			{% if tracking.warehouse == True %}
																			<option value="true" selected>Yes</option>
																			<option value="false">No</option>
																			{% else %}
																			<option value="true">Yes</option>
																			<option value="false" selected>No</option>
																			{% endif %}
																		</select>
																	</td>
																	<td>
																		<select name="city" class="form-select" id="inlineFormSelectPref">
																			{% if tracking.city == True %}
																			<option value="true" selected>Yes</option>
																			<option value="false">No</option>
																			{% else %}
																			<option value="true">Yes</option>
																			<option value="false" selected>No</option>
																			{% endif %}
																		</select>
																	</td>
																	<td>
																		<select name="livry" class="form-select" id="inlineFormSelectPref">
																			{% if tracking.livry == True %}
																			<option value="true" selected>Yes</option>
																			<option value="false">No</option>
																			{% else %}
																			<option value="true">Yes</option>
																			<option value="false" selected>No</option>
																			{% endif %}
																		</select>
																	</td>
																	<td>
																		<button type="submit" class="btn btn-outline-success">Submit</button>
																	</td>
																</tr>
															</form>
														{% endfor %}
													</tbody>
												</table>
											</div>
										</div>
									</div>
								</div>
							</div>
							<!-- end -->
							<!-- custemers and admin-delivery  -->
							<div class="row justify-content-between mb-5">
								<div class="show-data packages col-12 mt-5">
									<div class="top">
										<h1>packages</h1>
										<small class="ms-2 " style="color: #efcefa;">{{packages.count}}</small>
									</div>
									<div class="body">
										<div class="filter">
											<form action="" method="GET">
												<input oninput="searchId(idSearch='search-package', idClass='id-package')" type="search" name="search-package" id="search-package" placeholder="search with id">
											</form>
										</div>
										<div class="content">
											<div class="package">
												<table class="table table-bordered table-hover">
													<thead>
														<tr>
															<th scope="col">ID</th>
															<th scope="col">Client</th>
															<th scope="col">Etat</th>
															<th scope="col">City</th>
															<th scope="col">Phone</th>
															<th scope="col">Date</th>
															<th scope="col">Actions</th>
														</tr>
													</thead>
													<tbody >
														{% for package in packages %}
															<tr>
																<th scope="row" name="id_package" data="{{pack.id_package}}" class="id id-package" id="ind">{{package.id_package}}</th>
																<td>{{package.client_name}}</td>
																{% if package.etat == "Ramassée"%}
																	<td><span class="badge text-bg-warning">{{package.etat}}</span></td>
																{% elif package.etat == "Annulée"%}
																	<td><span class="badge text-bg-danger">{{package.etat}}</span></td>
																{% elif package.etat == "Livrée"%}
																	<td><span class="badge text-bg-success">{{package.etat}}</span></td>
																{% elif package.etat == "Pas de réponse"%}
																	<td><span class="badge text-bg-info">{{package.etat}}</span></td>
																{% else %}
																	<td><span class="badge text-bg-dark">{{package.etat}}</span></td>
																{% endif %}
																<td>{{package.city}}</td>
																<td>{{package.phone_number}}</td>
																<td>{{package.date_created}}</td>
																<td>
																	<a href="{% url 'edite_package_in_delivery' package.user.id package.id_package %}"><i class='bx bx-message-square-edit'></i></a>
																</td>
															</tr>
														{% endfor %}
													</tbody>
												</table>
											</div>
										</div>
									</div>
								</div>
							</div>
							<!-- end -->
							<!-- exchange and refund -->
							<div class="row justify-content-between mb-5">
								<div class="show-data refund col-5 mb-3">
									<div class="top">
										<h1>refunds</h1>
										<small class="ms-2 " style="color: #efcefa;">{{refunds.count}}</small>
									</div>
									<div class="body">
										<div class="filter">
											<form action="" method="GET">
												<input oninput="searchId(idSearch='search-refund', idClass='id-refund')" type="search" name="search-refund" id="search-refund" placeholder="search with id">
											</form>
										</div>
										<div class="content">
											<div class="refund">
												<table class="table table-bordered table-hover">
													<thead>
														<tr>
															<th scope="col">ID</th>
															<th scope="col">Price</th>
															<th scope="col">Actions</th>
														</tr>
													</thead>
													<tbody >
														{% for refund in refunds %}
														<tr>
															<th scope="row" data="{{refund.refund_id}}" class="id id-refund" id="ind">{{refund.refund_id}}</th>
															<td>{{refund.refund_price}}</td>
															<td>
																<a href="{% url 'view_refund' refund.user.id refund.refund_id %}"><i class='bx bx-show'></i></a>
															</td>
														</tr>
														{% endfor %}
													</tbody>
												</table>
											</div>
										</div>
									</div>
								</div>
								<div class="show-data exchange col-5 m-1">
									<div class="top">
										<h1>exchanges</h1>
										<small class="ms-2 " style="color: #efcefa;">{{exchanges.count}}</small>
									</div>
									<div class="body">
										<div class="filter">
											<form action="" method="GET">
												<input oninput="searchId(idSearch='search-exchange', idClass='id-exchange')" type="search" name="search-exchange" id="search-exchange" placeholder="search with id">
											</form>
										</div>
										<div class="content">
											<div class="exchange">
												<table class="table table-bordered table-hover">
													<thead>
														<tr>
															<th scope="col">ID</th>
															<th scope="col">Client</th>
															<th scope="col">Actions</th>
														</tr>
													</thead>
													<tbody >
														{% for exchange in exchanges %}
														<tr>
															<th scope="row" data="{{exchange.exchange_id}}" class="id id-exchange" id="ind">{{exchange.exchange_id}}</th>
															<td>{{exchange.exchange_price}}</td>
															<td>
																<a href="{% url 'view_exchange' exchange.user.id exchange.exchange_id %}"><i class='bx bx-show'></i></a>
															</td>
														</tr>
														{% endfor %}
													</tbody>
												</table>
											</div>
										</div>
									</div>
								</div>
							</div>
							<!-- end -->
							<!-- support -->
							<div class="row justify-content-between mb-5">
								<div class="show-data support col-12">
									<div class="top">
										<h1>support</h1>
										<small class="ms-2 " style="color: #efcefa;">{{messages.count}}</small>
									</div>
									<div class="body">
										<div class="content">
											<div class="message">
												<div class="head-email">
													<div class="accordion" id="accordionExample">
														{% for message in messages %}
														<div class="accordion-item">
														  <h2 class="accordion-header" id="headingOne">
															<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
															  <span class="id"> {{message.email}} </span> &nbsp | &nbsp <span class="date-message" style="color:#838383"> {{message.date}}</span>
															</button>
														  </h2>
														  <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
															<div class="accordion-body">
															  <div class='subject'>
																<p class="pt-2 pb-2 mb-3"></span> {{message.subject}}</p>
															  </div>
															  <p class="pt-2 pb-2"> {{message.message}} </p>
															</div>
														  </div>
														</div>
														{% endfor %}
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<!-- end -->
						</div>
					</div>
				</div>
			</main>
			{% endblock content %}
		</div>
	</div>
</body>
<script type="text/javascript">
    let idPackage = document.querySelectorAll(".id");
    for (let i = 0; i<idPackage.length; i++){
        let orId = idPackage[i].textContent
        idPackage[i].onclick = () => {
            orId.select;
            navigator.clipboard.writeText(orId);
            alert("Copiez ensuite le ID avec succès " + orId)
        }
        let newIdPackage = idPackage[i].textContent;
        idPackage[i].textContent = newIdPackage + " ";
        idPackage[i].innerHTML += '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard2" viewBox="0 0 16 16"><path d="M3.5 2a.5.5 0 0 0-.5.5v12a.5.5 0 0 0 .5.5h9a.5.5 0 0 0 .5-.5v-12a.5.5 0 0 0-.5-.5H12a.5.5 0 0 1 0-1h.5A1.5 1.5 0 0 1 14 2.5v12a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 14.5v-12A1.5 1.5 0 0 1 3.5 1H4a.5.5 0 0 1 0 1h-.5Z"/><path d="M10 .5a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5.5.5 0 0 1-.5.5.5.5 0 0 0-.5.5V2a.5.5 0 0 0 .5.5h5A.5.5 0 0 0 11 2v-.5a.5.5 0 0 0-.5-.5.5.5 0 0 1-.5-.5Z"/></svg>';
        idPackage[i].style.color = "#735d78";
        idPackage[i].style.cursor = "pointer";
    }

	// script seach 
	
	function searchId(idSearch, idClass) {
		let idPachage = document.querySelectorAll(`.${idClass}`);
		let search = document.getElementById(`${idSearch}`);
		// search.oninput = function() {
		idPachage.forEach(t => {
			if (t.getAttribute("data") != "") {
				if (search.value !== "") {
					if (! t.getAttribute("data").includes(search.value)) {
						t.parentElement.style.display = "none"
					} else {
						t.parentElement.style.display = "revert"
					}
				} else {
					search.value = "";
					t.parentElement.style.display = "revert"
				}
			}
		})
		// }
	}
</script>

<script>
    const inputs = document.querySelectorAll("input");
    const selects = document.querySelectorAll("select")
    inputs.forEach(e => {
        e.classList.add("form-select")
    })
    selects.forEach(e => {
        e.classList.add("form-select")
    })
</script>

</html>